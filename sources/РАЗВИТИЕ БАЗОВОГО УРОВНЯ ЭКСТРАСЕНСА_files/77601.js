/*************************
 mybb.ru, 
 Своя(или стандартная) иконка к теме; Ч2 в Начало HTML низ!
 2.08.2015; v1.00;
 Author: Deff
*************************/
if(typeof(ICONS1)=="undefined"||typeof(ICONS1.ICON_Parse)=="undefined"){alert('В HTML Верх отсутствует Первая часть скрипта:\n      "Своя(или стандартная) иконка к теме" ')}else{ICONS1.ICON_Parse()}(function(){var t="¤";var m;var c;var s=$('#pun-post,#pun-edit,#post .required.longinput input[name="req_subject"]');var e=s.length==2&&$.inArray(GroupID,ICONS1.groups_edition)!=-1;s=$('#post .required.longinput input[name="req_subject"]').attr("autocomplete","off");if(s.length){var a=$('<span id="add-myicon" style="float:right;width:auto;display:none;text-align:right;width:33%;position:relative;"><label for="tema-icon" style="margin:-17px 0 -17px 3px;position:absolute;display:block;"> Своя иконка к теме</label><input id="tema-icon" style="width:46%" type="text" placeholder="URL of tema-icon"/> &#160;&#160;<input id="tstimg-url" type="button" style="width:46%" value="Добавить"/></span>');a.insertAfter(s);if(e){a.show()}var d='<div id="wrap-icon-tbl"><legend><span>Стандартные иконки Тем</span></legend><table id="icon-tbl" style="table-layout:fixed;width:100%;font: normal normal 400 11px/normal Verdana;"><tbody><tr class="icon-append" valign=center  align=center><td width=>Нет<br><input type="radio" value="" checked/></td><td class="a"><img src="http://savepic.ru/7679320.gif" alt="" height="28" style="margin:-9px auto -8px auto"/><br><input type="radio" value="a"/></td></tr></tbody></table></div>';if(e){$(d).insertAfter("#post .required.longinput");$("#post").addClass("Up")}if(!e){$(d).appendTo($("#post .required.longinput").parent());$("#post").addClass("Down")}var j='<td><img src="##1" alt=""/><br><input type="radio" value="##2"/></td>';var b=true;if(ICONS1.icon_Image.a!="http://savepic.ru/7679320.gif"){b=false;$("#icon-tbl tr.icon-append>.a").remove()}for(var r in ICONS1.icon_Image){if(!(r=="a"&&b)){$(j.replace("##1",ICONS1.icon_Image[r]).replace("##2",r)).appendTo("#icon-tbl .icon-append")}}var u=$('#wrap-icon-tbl td > input[type="radio"]');function o(x){var i=ICONS1.image_maxLength;if(!x.match(/^https?:\/\//)){alert("Неверный формат ссылки");return false}return"http://uploads.ru/api?upload="+x+"&resize_width="+i+"&thumb_width="+i+"&format=JSON&callback=parseResponse"}function n(w){if(w.match(/^https?:\/\//)){return[w,"MyTemaIcon"]}if(w.length==1&&ICONS1.icon_Image[w]){return[ICONS1.icon_Image[w],"StTemaIcon "+w]}if(w.length!=8||w.match(/[^0-9a-z]/i)||!w.match(/j|p|g$/)){return false}var i={j:"jpg",p:"png",g:"gif"}[w.slice(-1)];return[w.replace(/^(.{2})(.*)?.$/,"http://$1.uploads.ru/t/$2."+i),"MyTemaIcon"]}var q="#post .required.longinput .container.view-img";function p(w){$(q).remove();var i='<span class="container view-img">Своя иконка Темы<img src="'+w+'" height="34" title=" Preview-img "/></span>';$(i).appendTo("#post .required.longinput");$("#post #tema-icon").val(w);w=w.substr(7).split(".uploads.ru/t/").join("").replace(/\.(.).*$/,"$1");f();m=w}var h="#post .required.longinput .view-img:not(.hover),#post .required.longinput #tstimg-url:not(.hover)";if(e){$(h).live("mouseenter",function(){var i=$(this).addClass("hover");setTimeout(function(){i.removeClass("hover")},2200)})}window.parseResponse=function(i){if(i.status_code=200){p(i.data.thumb_url);alert("Данная иконка перезалита и будет присоединена к этой теме!")}else{alert("Oшибка обработки сервером")}};function k(w){var i=w.split(/http:\/\/..|uploads\.ru\/t\/.*?\.(?:png|jpg|gif)$/)[1];if(i=="."){p(w);alert("Данная иконка будет присоединена к этой теме!");return}if(w=o(w)){$.getScript(w)}}function l(y){var i=$.trim(y).split(t),w=false,z=false;if(i.length>=3){y=$.trim(i[0]);s.val(y);w=$.trim(i[1]);var x=n(w)[0];if(!x){return false}if(ICONS1.icon_Image[w]){u.filter('[value="'+w+'"]').click();return true}if(w.match(/^https?:\/\//)){k(w);return}if(x){p(x);return true}}return false}function f(){u.attr("checked",false).parent().removeClass("active");u.eq(0).attr("checked",true);m=""}u.bind("click change",function(){g(this)});function g(i){$("#tema-icon").val("");u.not(i).attr("checked",false).parent().removeClass("active");$(i).attr("checked",true).parent().addClass("active");m=i.value;$(q).remove()}$("#tstimg-url").click(function(){var i=$(this).prev().val();k(i)});s.bind("input focus blur",function(){clearTimeout(c);c=setTimeout(function(){l(s.val())},200)});function v(){s.unbind("input focus blur");clearTimeout(c)}$('#post input[type="submit"]').click(function(){var i=$.trim(s.val());if(i&&m){s.css({color:"transparent"});setTimeout(function(){s.css({color:""})},2000);s.val(i+" "+t+m+t)}});l(s.val())}}());