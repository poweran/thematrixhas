!function(){FORUM.set("editor",new Object({settings:{autofocus:"enabled"},font:{name:"Шрифт",onclick:function(){n("font-area")},container:"font-area",fonts:["Arial","Arial Black","Arial Narrow","Book Antiqua","Century Gothic","Comic Sans Ms","Courier New","Fixedsys","Franklin Gothic Medium","Garamond","Georgia","Impact","Lucida Console","Microsoft Sans Serif","Palatino Linotype","System","Tahoma","Times New Roman","Trebuchet Ms","Verdana"]},size:{name:"Размер",onclick:function(){n("size-area")},container:"size-area",sizes:[8,10,12,14,16,18,20],unit:"px"},bold:{name:"Жирный",onclick:function(){bbcode("[b]","[/b]")}},italic:{name:"Наклонный",onclick:function(){bbcode("[i]","[/i]")}},underline:{name:"Подчеркнутый",onclick:function(){bbcode("[u]","[/u]")}},strike:{name:"Зачеркнутый",onclick:function(){bbcode("[s]","[/s]")}},left:{name:"Выравнивание по левому краю",onclick:function(){bbcode("[align=left]","[/align]")}},center:{name:"Выравнивание по центру",onclick:function(){bbcode("[align=center]","[/align]")}},right:{name:"Выравнивание по правому краю",onclick:function(){bbcode("[align=right]","[/align]")}},link:{name:"Ссылка",onclick:function(){!function(){if($("#main-reply").getSelection().length>0&&$("#main-reply").getSelection().text.match(/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/))bbcode("[email]","[/email]");else{var e=FORUM.get("editor.link.link_url()");if(!e||null==e||"https://"==e||""==$.trim(e))return!1;if(0!=e.indexOf("#")||$("span"+e).length){if(0==$("#main-reply").getSelection().length){var t=FORUM.get("editor.link.link_title()");t&&null!=t&&"https://"!=t&&""!=$.trim(t)||(t=e)}if(FORUM.get("editor.link.short_url('"+e+"')")&&(ShortURLService="http://qps.ru/api?url="+encodeURIComponent(e)+"&format=text",$.ajax({url:ShortURLService,type:"get",dataType:"text",async:!1,success:function(t){if(!t.match(/^https?:/))return FORUM.get("editor.link.invalid_link()"),e=!1,!1;e=t}}),!e))return!1;t?insert("[url="+e+"]"+t+"[/url]"):bbcode("[url="+e+"]","[/url]")}else alert("На этой странице нет такого якоря")}}()},link_url:function(){return prompt("Поместите ссылку веб-страницы или #якорь","https://")},link_title:function(){return prompt("Введите название ссылки","Ссылка")},short_url:function(e){return!1},invalid_link:function(){return alert("Неверный формат ссылки")}},spoiler:{name:"Свернутый текст",onclick:function(){n("spoiler-area")},container:"spoiler-area",title:function(){return prompt("Введите заголовок","")},no_title:"Свернутый текст"},image:{name:"Изображение",onclick:function(){"none"==$("#image-area").css("display")&&$("#main-reply").getSelection().length>0&&$("#main-reply").getSelection().text.match(/^https?:\/\//)?bbcode("[img]","[/img]"):n("image-area")},container:"image-area",img_append:"\\n",img_bbcodes:{viewer:{name:"Превью",format:function(e,t,i,n){return"[url="+e+"][img]"+i+"[/img][/url]"+n},selected:!0},source:{name:"Оригинал",format:function(e,t,i,n){return"[img]"+(t.match(/^.+\.(jpe?g|png|gif|webp)$/)?t:i)+"[/img]"+n},selected:!1}},image_resize:{name:"Уменьшить до:",sizes:[640,800,1024,1280],selected:!1},thumb_resize:{name:"Ширина превью:",sizes:[120,160,240,360,480,600],selected:360},pixels:"пикселей",confirm_delete:function(){return confirm("Вы действительно хотите удалить загруженные файлы с сервера?")}},video:{name:"Видео",onclick:function(){n("video-area")},container:"video-area",hosts:["youtube.com","rutube.ru","vk.com","coub.com","ok.ru","vlipsy.com","ivi.ru","vimeo.com","myspace.com","facebook.com","1tv.ru","5-tv.ru","russia.tv","iz.ru","ria.ru","liveleak.com","hlamer.ru","t.me","plvideo.ru"]},hide:{name:"Скрытый текст",onclick:function(){var e;(e=FORUM.get("editor.hide.hide_num_posts()"))?bbcode("[hide="+e+"]","[/hide]"):bbcode("[hide]","[/hide]")},hide_num_posts:function(){return prompt("Введите минимум сообщений для просмотра текста","")}},quote:{name:"Цитата",onclick:function(){bbcode("[quote]","[/quote]")},username_append:"\n",quote_fail:function(){return alert("Не выделен текст для цитирования")}},code:{name:"Код",onclick:function(){bbcode("[code]","[/code]")}},color:{name:"Цвет",onclick:function(){n("color-area")},container:"color-area",colors:["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua"]},table:{name:"Таблица",onclick:function(){n("table-area")},container:"table-area",cols:10,rows:10,layout:"fixed"},smile:{name:"Смайлик",onclick:function(){!function(){if($("#smilies-block").length>0&&0==$("#smilies-block img").length){var e="";$.each(FORUM.get("editor.smile.smilies"),(function(t,i){var n=t.replace(/'/g,"\\'");e+='<img src="/'+FORUM.get("editor.smile.dir")+"/"+i+'" alt="'+t+'" title="'+t+'" onclick="smile(\''+n+"')\" onerror=\"this.src=this.src+'?'+Math.random()\" />\n"})),$("#smilies-block").append(e)}n("smilies-area")}()},container:"smilies-area"},keyboard:{name:"Виртуальная клавиатура",onclick:function(){n("keyboard-area")},container:"keyboard-area",keys:["&#9786;","&#9787;","&#9788;","&#9792;","&#9794;","&#9834;","&#9835;","&#12483;","&spades;","&clubs;","&hearts;","&diams;","&#9733;","&#9734;","_NL_","&frac14;","&frac12;","&frac34;","&cent;","&#8364;","&pound;","&times;","&alpha;","&beta;","&pi;","&phi;","&Omega;","&ne;","&oplus;","&otimes;","_NL_","&sect;","&#177;","&#8224;","&#9840;","&#8249;","&#8250;","&larr;","&uarr;","&rarr;","&darr;","&#9668;","&#9650;","&#9658;","&#9660;","_NL_","Tab","Q","W","E","R","T","Y","U","I","O","P","Back","_NL_","Caps","A","S","D","F","G","H","J","K","L","Enter","_NL_","!","?","Z","X","C","V","B","N","M",",",".","_NL_","@","&#169;","&#174;","&#8482;","&#176;","      Space      ","&#171;","&#187;","/","&#8212;","&#9679;","&#8226;"]},addition:{name:"Дополнительно",onclick:function(){n("addition-area")},container:"addition-area",tags:{you:{name:"Имя читателя",onclick:function(){insert("[you]")}},add:{name:"Добавлено спустя…",onclick:function(){insert("[add]\n")}},abbr:{name:"Поясняющий текст",onclick:function(){!function(){var e=FORUM.get("editor.addition.tags.abbr.abbr_title()");if(!e||null==e||""==$.trim(e))return!1;var t=!1;0==$("#main-reply").getSelection().length&&(t=FORUM.get("editor.addition.tags.abbr.abbr_content()")),t?insert('[abbr="'+e+'"]'+t+"[/abbr]"):bbcode('[abbr="'+e+'"]',"[/abbr]")}()},abbr_title:function(){return prompt("Введите поясняющий текст","")},abbr_content:function(){return prompt("Введите исходный текст","")}},anchor:{name:"Якорь",onclick:function(){!function(){var e=FORUM.get("editor.addition.tags.anchor.tag_name()");if(!e||null==e||""==$.trim(e)||-1==!e.search(/^[a-z0-9]+$/i))return!1;if($("span#"+e).length)return alert("Такой якорь уже есть на странице"),"";if(0==$("#main-reply").getSelection().length)var t=FORUM.get("editor.addition.tags.anchor.tag_title()");t?insert("[anchor="+e+"]"+t+"[/anchor]"):bbcode("[anchor="+e+"]","[/anchor]")}()},tag_name:function(){return prompt("Введите якорь (латиница и/или цифры)","")},tag_title:function(){return prompt("Введите поясняющий текст","")}},mark:{name:"Маркированный текст",onclick:function(){bbcode("[mark]","[/mark]")}},sup:{name:"Надстрочный текст",onclick:function(){bbcode("[sup]","[/sup]")}},sub:{name:"Подстрочный текст",onclick:function(){bbcode("[sub]","[/sub]")}},hr:{name:"Горизонтальная линия",onclick:function(){insert("[hr]\n")}},ul:{name:"Список",onclick:function(){bbcode("[ul]\n","\n[/ul]")}}}}}));var e,t=!1,i=!1;function n(e){var t=document.getElementById(e);null!=t&&void 0!==t&&("none"==t.style.display?$(t).show():$(t).hide())}function a(e){insert(function(e){var t=$("#selected-insert-format").val(),i=$(e).attr("data-img-view"),n=$(e).attr("data-img-url"),a=$(e).attr("src"),o=FORUM.get("editor.image.img_append");return FORUM.get("editor.image.img_bbcodes['"+t+"'].format('"+i+"', '"+n+"', '"+a+"', '"+o+"')")}(e))}function o(){if(window.MYBB_VideoScript&&window.MYBB_bindVideoScriptITV){try{clearInterval(window.MYBB_bindVideoScriptITV),window.MYBB_bindVideoScriptITV=!1}catch(n){}return!1}var e=document.getElementById("video-area").getElementsByTagName("a");if(e)for(var t=e.length,i=0;i<t;i++){var n=e.item(i);n&&n.className.indexOf("turn_link")>=0&&(n.onclick=function(e){return function(){return r.reInit(),r.clickHost(e),!1}}(n))}return window.MYBB_VideoScript=!0,!0}window.insert=function(t){if($("#main-reply").focus(),$.browser.msie&&e&&$("#main-reply").setSelection(e.start,e.end),$("#main-reply").collapseSelection(),i=$("#main-reply").getSelection(),$("#main-reply").insertText(t,i.start,!0),$.browser.opera){var n=t.match(/\n/g);if(null!=n&&n.length>0){var a=$("#main-reply").getSelection().end;$("#main-reply").setSelection(a+n.length+1,a+n.length+1),$("#main-reply").collapseSelection()}}return $("#main-reply").focus(),i=$("#main-reply").getSelection(),$.browser.msie&&(e=i),!1},window.bbcode=function(t,n){return $("#main-reply").focus(),$.browser.msie&&e&&$("#main-reply").setSelection(e.start,e.end),i=$("#main-reply").getSelection(),($.browser.msie||$.browser.opera)&&(t=t.replace(/\n/g,"\r\n")),$("#main-reply").surroundSelectedText(t,n),$("#main-reply").focus(),i=$("#main-reply").getSelection(),$.browser.msie&&(e=i),!1},$(document).ready((function(){if($("#image_upload").length>0){$("#image_upload :button").click((function(){$("#image_upload_input").click()}));var e=/(\.|\/)(gif|jpe?g|png|webp)$/i,t=$("<button/>").hide().addClass("btn btn-primary fileupload").prop("disabled",!0);$("#image_upload_input").fileupload({url:"/upload",maxNumberOfFiles:100,autoUpload:!1,acceptFileTypes:e,previewMaxWidth:120,previewMaxHeight:100,previewCrop:!0,sequentialUploads:!0,progressInterval:2,bitrateInterval:2}).on("fileuploadadd",(function(i,n){if($.each(n.files,(function(i,a){if(!a.name.match(e))return alert("Недопустимый тип файла ".concat(a.name,".")),!1;var o=Math.random().toString().substr(6),r=(a.size/1e3).toFixed(2)+" kB";a.uploadID="f"+o;var l,s=$('<div class="uploadQueueItem" id="upload_f'+o+'" data-name="'+a.name+'" data-modified="'+a.lastModified+'"><div class="cancel"><a href="javascript://">&#215;</a></div><span class="fileName">'+(a.name.length<=34?a.name:a.name.substr(0,32)+"...")+" ("+r+')</span><span class="percentage"></span><div class="uploadProgress"><div class="uploadProgressBar">\x3c!-- --\x3e</div></div></div>');s.append(t.clone(!0).on("click",(function(){var e=$(this);e.addClass("startedUpload").off("click"),l=n.submit().always((function(){e.remove()}))})).attr("id","btn-f"+o)),s.find(".cancel").on("click",(function(e){var t,i;e.preventDefault(),l&&l.abort(),t=e.target,(i=$(t).parents(".uploadQueueItem")).children("button").hasClass("startedUpload")&&i.children("button").click(),i.remove(),0==$("#imageQueue div.uploadQueueItem").length&&($("#imageQueue").hide(),$("#upload-button-container").hide(),$("#image-width").hide(),$("#image-thumb-width").hide(),0==$("#uploaded-images img").length&&($("#action-clean-uploaded").hide(),$("#load-image-container").hide())),$(this).parents(".uploadQueueItem").remove()})),$("#imageQueue > div").length<100&&0==$('.uploadQueueItem[data-modified="'+a.lastModified+'"][data-name="'+a.name+'"]').length&&$("#imageQueue").append(s),$("#imageQueue .error").remove()})),$("#imageQueue div").length>0){if(0==$("#uploaded-images img").length&&$("#imageQueue").css("max-height",150),$("#imageQueue").show(),$("#imageQueue .process").length||$("#load-image-container,#upload-button-container,#image-width,#image-thumb-width,#action-clean-uploaded").show(),$("#image-width").is(":empty")){var a='<option value=""'+(FORUM.get("editor.image.image_resize.selected")?"":' selected="selected"')+">----</option>";$.each(FORUM.get("editor.image.image_resize.sizes"),(function(e,t){a+='<option value="'+t+'"'+(FORUM.get("editor.image.image_resize.selected")==t?' selected="selected"':"")+">"+t+"</option>"})),$("#image-width").append("<strong>"+FORUM.get("editor.image.image_resize.name")+'</strong><br /><select id="selected-image-width">'+a+"</select>&nbsp;"+FORUM.get("editor.image.pixels"))}if($("#image-thumb-width").is(":empty")){var o="";$.each(FORUM.get("editor.image.thumb_resize.sizes"),(function(e,t){o+='<option value="'+t+'"'+(FORUM.get("editor.image.thumb_resize.selected")==t?' selected="selected"':"")+">"+t+"</option>"})),$("#image-thumb-width").append("<strong>"+FORUM.get("editor.image.thumb_resize.name")+'</strong><br /><select id="selected-thumb-width">'+o+"</select>&nbsp;"+FORUM.get("editor.image.pixels"))}}})).on("fileuploadstart",(function(){$("#upload-button-container").hide(),$("#image-width").hide(),$("#image-thumb-width").hide()})).on("fileuploadprogress",(function(e,t){var i=t.files[0].uploadID,n=parseInt(t.loaded/t.total*100,10);$("#upload_"+i).find(".uploadProgressBar").css("width",n+"%"),$("#upload_"+i).find(".percentage").text(" - "+n+"%")})).on("fileuploaddone",(function(e,t){var i=t.result.response,n=t.files[0].uploadID;if($("#upload_"+n).next().not(".error").length&&$("#upload_"+n).next().addClass("process").children(".btn").click(),i){var a='<img id="'+i.filename+'" src="'+UploadsURL+UserUploadsDir+"/t"+i.filename+'" title=Вставить data-img-url="'+UploadsURL+UserUploadsDir+"/"+i.filename+'" data-img-view="'+UploadsURL+UserUploadsDir+"/"+i.filename+'" onClick="insertUploadedImage(this);changeVisibility(\'image-area\');" />';0==$("#uploaded-images img").length&&$("#imageQueue").css("max-height",66),$("#uploaded-images").append(a),$("#"+i.filename.replace(".","\\.")).tipsy({gravity:"s"}),$("#upload_"+n).remove(),$("#imageQueue .process").length||$("#uploaded-images,#image-insert-format,#insert-all-images-container,#insert-image-tip,#action-insert-uploaded,#action-clean-uploaded,#action-drop-files").show()}else t.result.error?$("#upload_"+n).removeClass("process").addClass("error").find(".percentage").text(" - "+t.result.error.message):"200"!=t.result.status_code&&$("#upload_"+n).removeClass("process").addClass("error").find(".percentage").text(" - "+t.result.status_txt);if(0==$("#imageQueue div").length&&$("#imageQueue").hide(),$("#image-insert-format").is(":empty")){var o="";$.each(FORUM.get("editor.image.img_bbcodes"),(function(e,t){o+='<option value="'+e+'"'+(t.selected?' selected="selected"':"")+">"+t.name+"</option>"})),$("#image-insert-format").append('<strong>Вставить как:</strong><br /><select id="selected-insert-format">'+o+"</select>")}$("#image_upload_input").trigger("upload-success")})).on("fileuploadfail",(function(e,t){if(t.errorThrown||(t.errorThrown="HTTP Error"),t.files[0].uploadID){var i=t.files[0].uploadID;$("#upload_"+i).next().not(".error").length&&$("#upload_"+i).next().addClass("process").children(".btn").click(),$("#upload_"+i).removeClass("process").addClass("error").find(".percentage").text(" - "+t.errorThrown)}$("#image_upload_input").trigger("upload-fail")}))}}));var r={cH:null,RG:{"youtube.com":{l:"1",t:"youtube.com",x:/(?:shorts\/|v[=\/])([A-Za-z0-9_-]+)(?:[^A-Za-z0-9_-]|$)/,nf:"https://www.youtube.com/watch?v=%TOKEN%"},"youtu.be":{l:"1",t:"youtu.be",x:/youtu\.be\/([A-Za-z0-9_-]+)/,nf:"https://www.youtube.com/watch?v=%TOKEN%"},"ivi.ru":{l:"1",t:"ivi.ru",x:/(?:watch\/|videoId=)(\d+)/,nf:"https://www.ivi.ru/watch/%TOKEN%"},"rutube.ru":{l:"0",t:"rutube.ru",x:/rutube\.ru\/play\/embed\/([a-f\d]+)/,nf:"https://video.rutube.ru/%TOKEN%"},"vimeo.com":{l:"1",t:"vimeo.com",x:/(?:vimeo\.com\/|clip_id=)(\d+)/,nf:"https://vimeo.com/%TOKEN%"},"myspace.com":{l:"1",t:"myspace.com",x:/myspace\.com\/gettingnailed\/video\/(.*?)/,nf:"https://myspace.com/gettingnailed/video/%TOKEN%"},"1tv.ru":{l:"1",t:"1tv.ru",x:/ru\/news(?:video|\/[a-z]+)\/(\d+)/,nf:"https://www.1tv.ru/newsvideo/%TOKEN%"},"5-tv.ru":{l:"1",t:"5-tv.ru",x:/5-tv\.ru\/(?:news|video)\/(\d+)\/?/,nf:"https://5-tv.ru/video/%TOKEN%/"},"russia.tv":{l:"0",t:"vgtrk.com",x:/(?:video\/id\/)(\d+)/,nf:"https://player.vgtrk.com/iframe/video/id/%TOKEN%/"},"iz.ru":{l:"0",t:"iz.ru",x:/iz\.ru\/video\/embed\/(\d+)/,nf:"https://iz.ru/video/embed/%TOKEN%"},"ria.ru":{l:"0",t:"ria.ru",x:/ria\.ru\/services\/video\/embed\/([A-Za-z0-9_-]+)\.html/,nf:"https://ria.ru/services/video/embed/%TOKEN%.html"},"liveleak.com":{l:"0",t:"liveleak.com",x:/liveleak\.com\/e\/([A-Za-z0-9_-]+)/,nf:"https://www.liveleak.com/e/%TOKEN%"},"vk.com":{l:"0",t:"vk.com/",m:"1",x:/video_ext.php\?oid=(-?\d+)&id=(-?\d+)&hash=([0-9a-f]+)(?:&hd=(\d+))?/i,nf:"https://vk.com/video%TK1%_%TK2%?h=%TK3%&hd=%TK4%"},"coub.com":{l:"1",t:"coub.com",x:/view\/([a-zA-Z\d]+)/,nf:"https://coub.com/view/%TOKEN%"},"ok.ru":{l:"1",t:"ok.ru",x:/ok\.ru\/video(?:embed)?\/(\d+)/,nf:"https://ok.ru/videoembed/%TOKEN%"},"facebook.com":{l:"1",t:"facebook.com",x:/www\.facebook\.com\/([0-9a-zA-Z\.-_\/]+)/,nf:"https://www.facebook.com/%TOKEN%"},"vlipsy.com":{l:"1",t:"vlipsy.com",x:/(?:vlp\.to\/|vlipsy\.com\/(?:vlip\/[\w-]+-|embed\/))([a-zA-Z\d]{8})$/,nf:"https://vlipsy.com/embed/%TOKEN%"},"hlamer.ru":{l:"1",t:"hlamer.ru",x:/hlamer\.ru\/(video\/\d+-.*)\/?/,nf:"https://hlamer.ru/%TOKEN%"},"t.me":{l:"1",t:"t.me",x:/t\.me\/([0-9a-zA-Z\.-_]+\/\d+)/,nf:"https://t.me/%TOKEN%?embed=1&tme_mode=1"},"plvideo.ru":{l:"1",t:"plvideo.ru",x:/plvideo\.ru\/watch\?v=([0-9a-zA-Z\.-_]+)/,nf:"https://plvideo.ru/watch?v=%TOKEN%"}},checkHost:function(e,t){var i=!1,n=e.x.exec(t);if(n&&n.length>=2)if(e.m){for(var a=e.nf,o=1;o<n.length;o++)n[o]||(n[o]=""),a=a.replace(new RegExp("%TK"+o+"%","g"),n[o]);i=a}else i=e.nf.replace(/%TOKEN%/g,n[1]);return i},clickHost:function(e){var t=e.hash&&0==e.hash.indexOf("#")?e.hash.substring(1):e.hash,i=e.innerHTML;document.getElementById("video-area-hsel").style.display="none",document.getElementById("video-area-actions").style.display="block",document.getElementById("video-area-tcon").style.display="block";var n="0"==r.RG[t].l?"Вставьте embed-код видеофайла":"Вставьте ссылку или embed-код видеофайла";n+=" "+i,document.getElementById("video-area-thd").innerHTML=n,r.cH=t},parse:function(){var e=document.getElementById("video-area-tinp").value,t=!1;for(var i in r.RG){var n=r.RG[i].t;if(n&&e.indexOf(n)>=0){t=i;break}}if(t){var a=r.RG[t],o=(a.cF&&"function"==typeof a.cF?a.cF:r.checkHost)(a,e);o?(insert("[video]"+o+"[/video]"),document.getElementById("video-area").style.display="none",r.reInit()):r.isLink(e)?r.message("Ссылка не распознана. Попробуйте вставить код видео-ролика."):r.message("Код не распознан.")}else r.message("Код не распознан.")},isLink:function(e){return/^\s*http?:\/\//.test(e)},message:function(e){document.getElementById("video-area-msg").innerHTML=e},reInit:function(){document.getElementById("video-area-hsel").style.display="block",document.getElementById("video-area-actions").style.display="none",document.getElementById("video-area-tcon").style.display="none",document.getElementById("video-area-tinp").value="",document.getElementById("video-area-thd").innerHTML="",document.getElementById("video-area-msg").innerHTML=""}};window.quote=function(e,t,i){var n="";if(window.getSelection&&!$.browser.opera?n=window.getSelection().toString():document.getSelection?n=document.getSelection():document.selection&&(n=document.selection.createRange().text),""==n||void 0===n||null==n){var a=document.getElementById("p"+t+"-content");if($.browser.msie)(o=document.body.createTextRange()).moveToElementText(a),o.select(),n=document.selection.createRange().text;else if($.browser.mozilla){var o,r=window.getSelection();(o=document.createRange()).selectNodeContents(a),r.removeAllRanges(),r.addRange(o),n=window.getSelection().toString()}else n="",$("#p"+t+"-content > p").each((function(e){p=$(this).html().replace(/<br([\/ ]){0,2}>/gi,"\n"),el=$('<div style="display:none"></div>'),$(el).append(p),n+=$(el).text()+"\n\n"})),n=n.replace(/\r\n/g,"\n").replace(/\n\n\n/g,"\n\n");if(""==n||void 0===n||null==n)return void FORUM.get("editor.quote.quote_fail()")}if($.browser.mozilla&&-1!=n.indexOf("http://")){var l=new Array,s="";$("#p"+t+"-content img").each((function(e){s=$(this).attr("src"),l.length>0&&-1!=l.join(",").indexOf(s)||(n=n.replace(new RegExp(s,"g"),"[img]"+s+"[/img]"),l.push(s))}))}insert('[quote="'+e+'"]'+$.trim(n)+"[/quote]\n")},window.changeVisibility=n,window.smile=function(e){return insert(" "+e+" ")},window.tag_table=function(e,t){for(var i=("auto"==FORUM.get("editor.table.layout")?"[table layout=auto width=auto]":"[table layout=fixed width=100%]")+"\n",n=1;n<=t;n++){i+="[tr]\n";for(var a=1;a<=e;a++)i+="[td][/td]\n";i+="[/tr]\n"}i+="[/table]",bbcode(i.substr(0,i.indexOf("[/td]")),i.substr(i.indexOf("[/td]")))},window.MYBB_vsi=function(e,t){if(null==e.getElementsByTagName("a").item(0).onclick){o();var i=(t=t&&t[0]?t[0]:window.event).srcElement||t.target;i&&i.tagName&&"a"==i.tagName.toLowerCase()&&function(e){r.reInit(),r.clickHost(e)}(i)}},window.MYBB_vsc=r,window.insertUploadedImage=a,window.tag_spoiler=function(e){$("#spoiler-area").hide();var t=FORUM.get("editor.spoiler.title()");return null==t||(t&&""!=$.trim(t)||(t=FORUM.get("editor.spoiler.no_title")),bbcode("["+e+'="'+t+'"]',"[/"+e+"]")),!1},window.keyboard=function(n){if($("#main-reply").focus(),"Caps"==n)t=!t;else if("Back"==n)$.browser.msie&&e&&$("#main-reply").setSelection(e.start,e.end),i=$("#main-reply").getSelection(),$("#main-reply").setSelection(i.start-1,i.start),$("#main-reply").deleteSelectedText(),i=$("#main-reply").getSelection(),$.browser.msie&&(e=i);else if("Tab"==n)insert("\t");else if("Enter"==n)insert("\n");else if("      Space      "==n)insert(" ");else{var a=n.charCodeAt(0);0==t&&(168==a?a=184:1025==a?a=1105:a>=65&&a<=90&&(a+=32)),n=String.fromCharCode(a),insert(n)}},window.to=function(e){insert("[b]"+e+"[/b]"+FORUM.get("editor.quote.username_append"))},$(document).ready((function(){$("#main-reply").length>0&&($("#action-computer").click((function(){return $("#image-area-sels").hide(),$("#image-area-tcon-computer").show(),$("#image-area-actions").show(),$("#uploaded-images img").length>0&&($("#action-insert-uploaded").show(),$("#action-clean-uploaded").show(),$("#action-drop-files").show()),$("#imageQueue div.uploadifyQueueItem").length>0&&$("#action-clean-uploaded").show(),!1})),$("#action-internet").click((function(){return $("#image-area-sels").hide(),$("#image-area-tcon-internet").show(),$("#image-area-actions").show(),(""!=$("#image-area-tinp").val()||$.browser.msie)&&($("#action-insert-textarea").show(),$("#action-clean-textarea").show()),!1})),$("#action-clean-textarea").click((function(){return $("#image-area-tinp").val(""),$.browser.msie||($("#action-insert-textarea").hide(),$("#action-clean-textarea").hide()),!1})),$("#action-clean-uploaded").click((function(){return $("#imageQueue").empty(),$("#uploaded-images").empty().hide(),$("#image-insert-format,#insert-all-images-container,#insert-image-tip").hide(),$("#action-insert-uploaded,#action-clean-uploaded,#action-drop-files").hide(),$("#load-image-container,#imageQueue,#upload-button-container").hide(),$("#image-width,#image-thumb-width").hide(),!1})),$("#action-insert-textarea").click((function(){var e=$("#image-area-tinp").val().replace(/\r\n/g,"\n").split(/\n/);for(var t in e)$.trim(e[t]).length>0&&insert(FORUM.get("editor.image.img_bbcodes.source.format(false,'"+e[t]+"',false,'"+FORUM.get("editor.image.img_append")+"')"));return n("image-area"),!1})),$("#action-insert-uploaded").click((function(){return $("#uploaded-images img").each((function(e,t){a(this)})),n("image-area"),!1})),$("#action-close").click((function(){return n("image-area"),!1})),$("#action-return").click((function(){return $("#image-area-tcon-internet").hide(),$("#image-area-tcon-computer").hide(),$("#image-area-actions").hide(),$("#action-insert-textarea").hide(),$("#action-clean-textarea").hide(),$("#insert-image-tip").hide(),$("#action-insert-uploaded").hide(),$("#action-clean-uploaded").hide(),$("#action-drop-files").hide(),$("#image-area-sels").show(),!1})),$("#upload-button-container :button").click((function(){$("#upload-button-container").hide(),$("#image-width").hide(),$("#image-thumb-width").hide(),$("#image_upload_input").fileupload("option","formData",{method:"upload.userfile",user_id:UserID,token:ForumAPITicket,thumb_width:$("#selected-thumb-width").val(),resize_width:$("#selected-image-width").val()}),$("#image-area .uploadQueueItem").not(".error").filter(":first").addClass("process").find(".btn.fileupload").click()})),$("#image-area-tinp").bind("keyup select click mouseout",(function(){""!=$(this).val()||$.browser.msie?($("#action-insert-textarea").show(),$("#action-clean-textarea").show()):($("#action-insert-textarea").hide(),$("#action-clean-textarea").hide())})),$.browser.msie&&$("#main-reply").bind("keyup select click mouseout",(function(){e=$(this).getSelection()})),$("#main-reply").mouseover((function(){"enabled"==FORUM.get("editor.settings.autofocus")&&"input"!=document.activeElement.tagName.toLowerCase()&&"textarea"!=document.activeElement.tagName.toLowerCase()&&($(this).focus(),$.browser.msie&&(e&&$(this).setSelection(e.start,e.end),e=$(this).getSelection()))})),$("#post input").mouseover((function(){"enabled"==FORUM.get("editor.settings.autofocus")&&"input"!=document.activeElement.tagName.toLowerCase()&&"textarea"!=document.activeElement.tagName.toLowerCase()&&$(this).focus()}))),$("#video-area").length>0&&(window.MYBB_bindVideoScriptITV=setInterval((function(){window.MYBB_bindVideoScript&&"function"==typeof window.MYBB_bindVideoScript&&o()}),20))}))}(),function(){var e={" ":"%20","+":"%2B","%":"%25","&":"%26","=":"%3D"};function t(t){for(var i="",n=t.length,a=0;a<n;a++){var o=t.charAt(a);if(void 0!==e[o])i+=e[o];else{var r=t.codePointAt(a),l=-1;if(r>65535&&a++,r<128?l=0:r>163&&r<188&&175!=r?l=1:r>1031&&r<1104?l=848:r>1103&&r<1108?l=921:1025==r?l=857:8212==r&&(l=8061),l)if(l>0){1==l&&(l=0);var s=(r-l).toString(16).toUpperCase();i+="%"+(1==s.length?"0":"")+s}else i+=encodeURIComponent("&")+"#"+r+";";else i+=o}}return i}function i(){var e=$("#post-form"),t=e.find("#post");t.data("action")&&t.attr("action",t.data("action")),$("script",e).remove(),e.insertAfter($(".linksb")),$("#main-reply").empty(),$("#post")[0].reset(),$("#post-preview").hide(),$("p .checkfield").remove(),$(".subject").remove(),$(".button.cancel").remove()}$.fn.extend({serialize2:function(){var e="",i=this.serializeArray();for(var n in i)n&&(e+="&"),e+=i[n].name+"="+t(i[n].value);return e}}),$(document).ready((function(){$(".button.preview").on("click",(function(){if($("#post button").prop("disabled",!0),!process_form($("#post")[0]))return $("#post button").prop("disabled",!1),!1;var e=$("#post-preview .post-content");return e.html('<img class="loading" src="/img/loading.gif">'),$("#post-preview").show(),$.post("/api.php?method=post.getPreview",$("#post").serialize2(),(function(t){$("#post button").prop("disabled",!1),t.error?(console.error(t.error.message),$.jGrowl.defaults.position="center",$.jGrowl(t.error.message,{Header:"Error",sticky:!0})):e.html(t.response),$(document).trigger("pun_preview")})),!1})),$(".button.ajax-post").on("click",(function(){if($("#post button").prop("disabled",!0),!process_form($("#post")[0]))return $("#post button").prop("disabled",!1),!1;var e=$(".topic .endpost"),t=0,n=0,a=0;e.length||($(".topic .post:last-child"),function(e){throw new TypeError('"last_post" is read-only')}(),a=1),e.length&&(t=e.attr("id").substring(1),n=e.find("h3 strong").text()),$(".formsubmit").prepend('<img class="loading" src="/img/loading.gif">'),$(".button.cancel").remove();var o="&last="+a+"&max_id="+t+(n?"&i="+n:""),r=$("#post").serialize2();return $.post($("#post").attr("action"),r+"&format=json"+o,(function(e){if($("#post button").prop("disabled",!1),$(".formsubmit .loading").remove(),e.error)console.error(e.error.message),$.jGrowl.defaults.position="center",$.jGrowl(e.error.message,{Header:"Error",sticky:!0});else if(e.success)$.jGrowl.defaults.position="center",$.jGrowl(e.success,{Header:"Success"}),$("#main-reply").empty(),$("#post")[0].reset(),$("#post-preview").hide(),$(document).trigger(e.premod?"pun_post_premod":"pun_post");else if(e.id){$.jGrowl.defaults.position="center",$.jGrowl(e.note,{Header:"Success"});var t=$("#p"+e.id+"-content");t.length&&(t.html(e.message),e.subject&&$("#pun-main h1 span").html(e.subject),i(),$("#p"+e.id)[0].scrollIntoView()),$(document).trigger($.Event("pun_edit",{sender:t,pid:e.id}))}else $(".topic .endpost").removeClass("endpost"),$(".topic .new-ajax").removeClass("new-ajax"),$(".topic").append(e),$(".topic .new-ajax").fadeIn(),a?$(".topic .new-ajax").first()[0].scrollIntoView():$(".topic .new-ajax").last()[0].scrollIntoView(),$("#main-reply").empty(),$("#post")[0].reset(),$("#post-preview").hide(),sharelink_init($(".topic .new-ajax .sharelink")),$(document).trigger("pun_post")})),!1})),$(".topic").on("click",".edit-ajax a",(function(e){var t=$(e.target),n=t.parents(".post"),a=$("#post-form"),o=a.find("#post"),r="edit.php?id="+n.attr("id").substring(1);return t.hasClass("disabled")||(t.addClass("disabled"),i(),$("script",a).remove(),a.insertAfter(n),t.prepend('<img class="loading" src="/img/loading.gif">'),$.post(r,"format=json&load=1",(function(e){if(t.removeClass("disabled"),$(".post-links img.loading").remove(),e.error)console.error(e.error.message),$.jGrowl.defaults.position="center",$.jGrowl(e.error.message,{Header:"Error",sticky:!0});else{var i=a.find("#main-reply");i.text((n=e.message,(l=document.createElement("textarea")).innerHTML=n,l.value)),e.checkboxes&&$(e.checkboxes).insertAfter(i),e.subject&&$(e.subject).insertBefore(i),o.data("action",o.attr("action")),o.attr("action",r),$(".formsubmit").append('<input type="submit" class="button cancel" name="cancel" value="X" accesskey="c">'),$(document).trigger("pun_preedit")}var n,l})).fail((function(){t.removeClass("disabled"),$(".post-links img.loading").remove(),$.jGrowl.defaults.position="center",$.jGrowl("error",{Header:"Error",sticky:!0})}))),!1})),$(".topic").on("click",".button.cancel",(function(){i()}))}))}();