<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workout Log</title>
  <style>
    :root {
      --bg: #0b1220;
      --card: #111827;
      --card-2: #020617;
      --border: #1f2937;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #38bdf8;
      --done: #22c55e;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1200px 600px at 20% -10%, #0f172a, var(--bg));
      color: var(--text);
      padding: 24px;
    }

    .container {
      max-width: 1200px;
      margin: auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    h1 {
      font-size: 22px;
      margin: 0;
    }

    .subtitle {
      color: var(--muted);
      font-size: 13px;
    }

    .card {
      background: linear-gradient(180deg, #020617, #020617) padding-box,
        linear-gradient(180deg, #1f2937, #020617) border-box;
      border: 1px solid transparent;
      border-radius: 18px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, .45);
      padding: 16px;
      margin-bottom: 24px;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-size: 13px;
    }

    thead th {
      position: sticky;
      top: 0;
      background: var(--card);
      z-index: 2;
      color: var(--muted);
      font-weight: 500;
      padding: 10px 6px;
      border-bottom: 1px solid var(--border);
    }

    tbody td {
      padding: 8px 6px;
      border-bottom: 1px solid var(--border);
      text-align: center;
    }

    tbody tr:hover {
      background: rgba(56, 189, 248, .04);
    }

    td.group {
      text-align: left;
      font-weight: 600;
      padding-left: 12px;
      white-space: nowrap;
      cursor: pointer;
      color: var(--accent);
    }

    td.group:hover {
      text-decoration: underline;
    }

    .cell {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    input {
      width: 46px;
      height: 32px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      text-align: center;
      font-size: 13px;
    }

    input:focus {
      outline: none;
      border-color: var(--accent);
    }

    button.set {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      transition: .15s;
      font-weight: 600;
    }

    button.set.done {
      background: var(--done);
      border-color: var(--done);
      color: #052e16;
    }

    button.set:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .controls {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }

    .controls button {
      padding: 10px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      cursor: pointer;
      font-weight: 500;
    }

    .controls button.primary {
      background: linear-gradient(180deg, #38bdf8, #0ea5e9);
      color: #002233;
      border: none;
    }

    #stats h2 {
      margin: 0 0 12px 0;
      font-size: 16px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
    }

    .stat {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px;
    }

    .stat .label {
      font-size: 12px;
      color: var(--muted);
    }

    .stat .value {
      font-size: 22px;
      font-weight: 600;
      margin-top: 4px;
    }

    /* Timer Styles */
    .timer-container {
      background: var(--card-2);
      margin-bottom: 20px;
      border-radius: 12px;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid var(--border);
    }

    .timer-display {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 32px;
      font-weight: 700;
      color: var(--accent);
      min-width: 100px;
    }

    .timer-controls {
      display: flex;
      gap: 8px;
    }

    .timer-btn {
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: .2s;
      font-weight: 500;
    }

    .timer-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .timer-btn.active {
      background: var(--accent);
      color: #0b1220;
      border-color: var(--accent);
    }

    #modalImg {
      background-color: #fff;
    }
  </style>
</head>

<body>
  <div class="container">

    <header>
      <div>
        <h1>Workout Log</h1>
        <div class="subtitle">2 тренировки · 4 подхода · подтверждение кнопкой</div>
      </div>
    </header>

    <div class="card">
      <table id="log"></table>
    </div>

    <div id="stats" class="card"></div>

    <div class="controls">
      <button class="primary" onclick="saveData()">Сохранить</button>
      <button onclick="resetData()">Сброс</button>
    </div>

  </div>

  <!-- Modal -->
  <div id="modal" onclick="if(event.target===this)closeModal()"
    style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px); z-index:1000; overflow-y:auto;">
    <div
      style="max-width:550px; margin:4% auto; background:var(--card); border-radius:18px; padding:24px; position:relative; box-shadow:0 25px 50px -12px rgba(0,0,0,0.5);">
      <button onclick="closeModal()"
        style="position:absolute; right:16px; top:16px; background:none; border:none; color:var(--muted); font-size:24px; cursor:pointer; padding:4px; line-height:1; z-index:10;">✕</button>
      <h2 id="modalTitle" style="margin-top:0; font-size:24px; margin-bottom:16px;"></h2>
      <img id="modalImg"
        style="width:100%; border-radius:12px; border:1px solid var(--border); margin-bottom:20px; aspect-ratio:16/9; object-fit:cover;" />

      <!-- Timer Interface -->
      <div class="timer-container">
        <div id="timerDisplay" class="timer-display">00:00</div>
        <div class="timer-controls">
          <button class="timer-btn" onclick="addTime(30)">+30s</button>
          <button class="timer-btn" onclick="toggleTimer()" id="timerToggleBtn">Start</button>
          <button class="timer-btn" onclick="resetTimer()">Reset</button>
        </div>
      </div>

      <div id="modalDesc" style="color:var(--text); line-height:1.6; font-size:15px;"></div>
    </div>
  </div>

  <script>
    const muscles = ['Ноги', 'Икры', 'Грудь', 'Спина', 'Кор'];

    const muscleDescriptions = {
      'Ноги': `
        <h3 style="margin-top:0; color:var(--accent);">Болгарские сплит-приседания</h3>
        <p>Это абсолютно лучшее упражнение для ног без веса. За счет того, что одна нога выключена из активной работы и находится на возвышении (диван, стул), рабочая нога получает колоссальную нагрузку и растяжение.</p>
        <p><strong>Техника:</strong> Встаньте спиной к стулу/дивану, положите подъем задней ноги на опору. Сделайте шаг вперед рабочей ногой. Медленно опускайтесь вниз, пока бедро передней ноги не станет параллельно полу. Колено задней ноги почти касается пола. Держите корпус ровно или слегка наклоните вперед для большего акцента на ягодицу.</p>
        <p><strong>Почему это топ:</strong> Развивает силу, массу, баланс и мобильность тазобедренного сустава одновременно.</p>
      `,
      'Икры': `
        <h3 style="margin-top:0; color:var(--accent);">Подъем на носок на одной ноге на возвышенности</h3>
        <p>Икры очень выносливы, их бесполезно тренировать обычными подъемами на двух ногах без веса по 100 раз. Секрет роста — максимальное растяжение под нагрузкой.</p>
        <p><strong>Техника:</strong> Встаньте одной ногой на край ступеньки, толстой книги или порога. Вторая нога поджата. Опустите пятку максимально низко, почувствуйте сильное натяжение в икре. Мощным движением поднимитесь на носок как можно выше, задержитесь на 1-2 секунды в пиковом сокращении. Опускайтесь медленно. Обязательно придерживайтесь рукой за стену для равновесия.</p>
        <p><strong>Почему это топ:</strong> Полная амплитуда движения и нагрузка всего веса тела на одну мышцу.</p>
      `,
      'Грудь': `
        <h3 style="margin-top:0; color:var(--accent);">Отжимания с ногами на возвышенности</h3>
        <p>Классические отжимания быстро становятся слишком легкими. Чтобы продолжать растить мышцы и силу, нужно увеличить нагрузку. Подняв ноги выше головы, мы смещаем центр тяжести и переносим значительно больший процент веса тела на руки и грудь, особенно акцентируя внимание на верхе грудных мышц.</p>
        <p><strong>Техника:</strong> Примите упор лежа, затем поставьте носки ног на устойчивый стул, диван или кровать. Тело должно образовывать идеально прямую линию от пяток до макушки (планка). Руки на ширине плеч или чуть шире. Медленно опускайтесь вниз, пока грудь не окажется в паре сантиметров от пола. Локти держите под углом примерно 45 градусов к телу (не разводите их широко в стороны, это вредно для плеч). Мощно выжмите себя в исходное положение.</p>
        <p><strong>Почему это топ:</strong> Самый простой и эффективный способ увеличить сложность базового движения и дать мышцам стимул к росту без железа.</p>
      `,
      'Спина': `
        <h3 style="margin-top:0; color:var(--accent);">Скольжение по полу на животе</h3>
        <p>Это упражнение использует ваш собственный вес и силу трения о пол для создания мощной нагрузки на широчайшие мышцы спины и мышцы, сводящие лопатки. Оно отлично имитирует подтягивания или вертикальную тягу.</p>
        <p><strong>Вам понадобится:</strong> Гладкий пол (ламинат, паркет, плитка, линолеум) и полотенце под грудь/живот для лучшего скольжения.</p>
        <p><strong>Техника:</strong> Лягте на живот, вытянув руки вперед как можно дальше. Вдавите ладони в пол. Напрягая мышцы спины (представьте, что вы подтягиваетесь на турнике), с силой потяните свое тело вперед по полу, сгибая руки в локтях и сводя лопатки вместе. Ноги держите расслабленными, они не должны помогать. В пиковой точке (когда локти будут на уровне корпуса) задержитесь на секунду и медленно оттолкнитесь обратно в исходное положение.</p>
        <p><strong>Почему это топ:</strong> Единственное в своем роде упражнение, позволяющее полноценно нагрузить тяговые мышцы спины без перекладины, используя только силу трения и вес тела.</p>
      `,
      'Кор': `
        <h3 style="margin-top:0; color:var(--accent);">Книжка</h3>
        <p>Это "король" динамических упражнений на пресс. В отличие от скручиваний (работает только верх пресса) или подъемов ног (работает только низ), складка требует одновременного сокращения всей прямой мышцы живота и мощной работы стабилизаторов, чтобы удержать баланс на ягодицах.</p>
        <p><strong>Техника:</strong> Лягте на спину, ноги прямые, руки вытянуты за голову. Поясница прижата к полу (это исходная позиция). На выдохе мощным движением одновременно поднимите прямые ноги и корпус вверх, стараясь коснуться руками стоп в верхней точке. Ваше тело должно сложиться пополам, как закрывающаяся книга. В верхней точке вы балансируете только на ягодицах. Медленно и подконтрольно вернитесь в исходное положение, не расслабляя пресс полностью.</p>
        <p><strong>Почему это топ:</strong> Одно движение прорабатывает весь "корсет" спереди и учит управлять своим телом в пространстве.</p>
      `
    };

    const muscleImages = {
      'Ноги': 'images/Ноги.svg',
      'Икры': 'images/Икры.svg',
      'Грудь': 'images/Грудь.svg',
      'Спина': 'images/Спина.svg',
      'Кор': 'images/Кор.svg'
    };

    const optimalTimes = {
      'Ноги': 90,   // Тяжелое базовое - долгий отдых или подход
      'Икры': 45,   // Изоляция - короче
      'Грудь': 60,  // Среднее
      'Спина': 60,  // Среднее
      'Кор': 30     // Интенсивное
    };

    const trainings = ['A', 'B'];
    const sets = [1, 2, 3, 4];

    const STORAGE_KEY = 'home_workout_table_v1';
    const STATS_KEY = 'home_workout_stats_v1';

    let state = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

    const keyOf = (m, t, s) => `${m}_${t}_${s}`;

    function render() {
      const table = document.getElementById('log');
      table.innerHTML = '';

      const thead = document.createElement('thead');
      thead.innerHTML = `<tr><th>Мышцы</th>${trainings.map(t => sets.map(s => `<th>${t}${s}</th>`).join('')).join('')}</tr>`;
      table.appendChild(thead);

      const tbody = document.createElement('tbody');

      muscles.forEach(m => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="group" onclick="openModal('${m}')">${m}</td>`;

        trainings.forEach(t => sets.forEach(s => {
          const key = keyOf(m, t, s);
          const cell = state[key] || { reps: '', done: false };
          const td = document.createElement('td');
          td.innerHTML = `
        <div class="cell">
          <input type="number" value="${cell.reps}" onchange="setReps('${key}',this.value)">
          <button class="set ${cell.done ? 'done' : ''}" onclick="toggle('${key}',this)">✓</button>
        </div>`;
          tr.appendChild(td);
        }));

        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
    }

    function setReps(key, val) {
      state[key] = state[key] || { reps: '', done: false };
      state[key].reps = val;
    }

    function toggle(key, btn) {
      state[key] = state[key] || { reps: '', done: false };
      state[key].done = !state[key].done;
      btn.classList.toggle('done');

      if (state[key].done) {
        const stats = JSON.parse(localStorage.getItem(STATS_KEY)) || [];
        stats.push({ key, reps: Number(state[key].reps) || 0, ts: Date.now() });
        localStorage.setItem(STATS_KEY, JSON.stringify(stats));
        renderStats();
      }
    }

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function resetData() {
      if (!confirm('Сбросить все данные?')) return;
      localStorage.clear();
      state = {};
      render();
      renderStats();
    }

    function openModal(muscle) {
      document.getElementById('modalTitle').innerText = muscle;
      document.getElementById('modalImg').src = muscleImages[muscle];
      document.getElementById('modalDesc').innerHTML = muscleDescriptions[muscle] || '';
      document.getElementById('modal').style.display = 'block';

      // Set optimal time for this muscle
      currentBaseTime = optimalTimes[muscle] || 60;
      resetTimer();
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
      stopTimer(); // Ensure timer stops when closing
    }

    // Timer Logic
    let timerInterval = null;
    let timerTime = 0;
    let currentBaseTime = 60;
    let timerRunning = false;
    let timerIsCountdown = true;

    function formatTime(t) {
      const m = Math.floor(Math.abs(t) / 60).toString().padStart(2, '0');
      const s = (Math.abs(t) % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function updateTimerDisplay() {
      document.getElementById('timerDisplay').innerText = formatTime(timerTime);
    }

    function toggleTimer() {
      if (timerRunning) {
        stopTimer();
      } else {
        startTimer();
      }
    }

    function startTimer() {
      if (timerRunning) return;
      if (timerTime <= 0 && timerIsCountdown) return;

      timerRunning = true;
      document.getElementById('timerToggleBtn').innerText = 'Pause';
      document.getElementById('timerToggleBtn').classList.add('active');

      timerInterval = setInterval(() => {
        if (timerIsCountdown) {
          timerTime--;
          if (timerTime <= 0) {
            // Timer finished
            timerTime = 0;
            stopTimer();
            // Optional: Play sound or vibrate here
          }
        } else {
          timerTime++;
        }
        updateTimerDisplay();
      }, 1000);
    }

    function stopTimer() {
      timerRunning = false;
      document.getElementById('timerToggleBtn').innerText = 'Start';
      document.getElementById('timerToggleBtn').classList.remove('active');
      if (timerInterval) clearInterval(timerInterval);
    }

    function resetTimer() {
      stopTimer();
      timerTime = currentBaseTime;
      timerIsCountdown = true;
      updateTimerDisplay();
    }

    function addTime(seconds) {
      // If we add time, we assume the user wants a countdown (e.g. for rest)
      if (!timerIsCountdown && timerTime === 0) {
        timerIsCountdown = true;
      }

      // If was stopwatch (counting up) and we add time, switching to countdown might be confusing if we don't reset.
      // But typically "add 30s" implies "I want a timer for 30s".
      // Let's simpler logic: always add to current time constant.

      if (!timerIsCountdown && timerTime > 0) {
        // If we were counting up, and user clicks +30s, do we convert to countdown?
        // Or just add 30s to the elapsed time?
        // Usually in workout app, +30s button is for REST timer.
        // So let's force countdown mode.
        timerIsCountdown = true;
      }

      // If switching from stopwatch 0 to countdown, it's fine.
      timerIsCountdown = true;
      timerTime += seconds;
      updateTimerDisplay();
      if (!timerRunning) startTimer();
    }

    function renderStats() {
      const stats = JSON.parse(localStorage.getItem(STATS_KEY)) || [];
      const box = document.getElementById('stats');

      if (!stats.length) { box.innerHTML = '<span class="subtitle">Статистика пуста</span>'; return; }

      const sum = {};
      stats.forEach(e => {
        const m = e.key.split('_')[0];
        sum[m] = sum[m] || { sets: 0, reps: 0 };
        sum[m].sets++; sum[m].reps += e.reps;
      });

      box.innerHTML = `
    <h2>Аналитика</h2>
    <div class="stats-grid">
      ${Object.entries(sum).map(([m, v]) => `
        <div class="stat">
          <div class="label">${m}</div>
          <div class="value">${v.sets} · ${v.reps}</div>
        </div>`).join('')}
    </div>`;
    }

    render();
    renderStats();
  </script>
</body>

</html>