<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workout Log</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="container">

    <header>
      <div class="logo">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="2" y="6" width="28" height="20" stroke="#38bdf8" stroke-width="2" />
          <path d="M7 16H25" stroke="#38bdf8" stroke-width="2" />
          <path d="M16 6V26" stroke="#38bdf8" stroke-width="2" />
          <circle cx="16" cy="16" r="4" fill="#0b1220" stroke="#38bdf8" stroke-width="2" />
        </svg>
        <div class="logo-text">WORKOUT<span>LOG</span></div>
      </div>
      <div style="text-align: right; font-size: 13px; color: var(--muted); line-height: 1.4;">
        <div>Приложение находится в разработке</div>
        <div>По всем вопросам: <a href="https://t.me/superslimfeel" target="_blank"
            style="color: var(--accent); text-decoration: none;">https://t.me/superslimfeel</a></div>
      </div>
    </header>

    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('workout')" data-tab="workout">Дневник</button>
      <button class="tab-btn" onclick="switchTab('analytics')" data-tab="analytics">Аналитика</button>
      <button class="tab-btn" onclick="switchTab('settings')" data-tab="settings">Настройки</button>
    </div>

    <!-- WORKOUT VIEW -->
    <div id="view-workout">

      <div class="week-nav">
        <button onclick="changeWeek(-1)">‹</button>
        <div class="week-nav-label" id="weekNavLabel">Текущая неделя</div>
        <button onclick="changeWeek(1)">›</button>
      </div>

      <div class="card">
        <table id="log"></table>
      </div>

      <div class="controls" style="align-items: center; flex-wrap: wrap;">
        <button class="primary" onclick="finishSet()">Закончить подход</button>

        <div style="display:flex; align-items:center; gap:8px;">
          <button onclick="toggleZapper()" id="zapperBtn"
            style="position:relative; height:40px; display:flex; align-items:center; gap:6px;">
            <span id="zapperIcon" style="opacity:0.5">⚡</span> Zapper
          </button>
          <canvas id="zapperScope" width="160" height="40"
            style="display:none; height:40px; background:#020617; border-radius:0; border:1px solid var(--border);"></canvas>
        </div>
      </div>
    </div>

    <!-- ANALYTICS VIEW -->
    <div id="view-analytics" style="display:none;">

      <!-- KPI Cards -->
      <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); margin-bottom: 24px;">
        <div class="stat">
          <div class="label">Всего тренировок</div>
          <div class="value" id="stat-workouts">0</div>
        </div>
        <div class="stat">
          <div class="label">Выполнено подходов</div>
          <div class="value" id="stat-sets">0</div>
        </div>
        <div class="stat">
          <div class="label">Время под нагрузкой</div>
          <div class="value" id="stat-time">0m</div>
        </div>
      </div>

      <div class="card">
        <h2 style="margin-top:0">Динамика нагрузки (минут)</h2>
        <div style="position: relative; height:300px; width:100%">
          <canvas id="historyChart"></canvas>
        </div>
      </div>

      <div class="card">
        <h2 style="margin-top:0">Распределение по группам</h2>
        <div style="position: relative; height:300px; width:100%">
          <canvas id="distChart"></canvas>
        </div>
      </div>

      <!-- Raw Stats fallback -->
      <div id="stats" class="card" style="margin-top:24px;"></div>
    </div>

    <!-- SETTINGS VIEW -->
    <div id="view-settings" style="display:none;">
      <div class="card" style="max-width: 600px; margin: 0 auto;">

        <div class="settings-group">
          <div class="setting-row">
            <div>
              <div class="setting-label">Дни тренировок</div>
              <div class="setting-desc">Количество тренировочных дней в одной неделе (A, B, C...)</div>
            </div>
            <div class="stepper">
              <button onclick="adjustSetting('setting-days', -1)">−</button>
              <input type="number" id="setting-days" readonly value="2">
              <button onclick="adjustSetting('setting-days', 1)">+</button>
            </div>
          </div>
        </div>

        <div class="settings-group">
          <div class="setting-row">
            <div>
              <div class="setting-label">Подходы</div>
              <div class="setting-desc">Количество подходов для каждого упражнения за один тренировочный день</div>
            </div>
            <div class="stepper">
              <button onclick="adjustSetting('setting-sets', -1)">−</button>
              <input type="number" id="setting-sets" readonly value="4">
              <button onclick="adjustSetting('setting-sets', 1)">+</button>
            </div>
          </div>
        </div>

        <div style="display:flex; justify-content: flex-end; margin-top: 32px;">
          <button class="primary" onclick="saveSettings()">Применить изменения</button>
        </div>
      </div>
    </div>

  </div>

  <!-- Modal -->
  <div id="modal" onclick="if(event.target===this)closeModal()"
    style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px); z-index:1000; overflow-y:auto;">
    <div
      style="max-width:550px; margin:4% auto; background:var(--card); border-radius:0; padding:24px; position:relative; box-shadow:0 25px 50px -12px rgba(0,0,0,0.5); border: 1px solid var(--border);">
      <button onclick="closeModal()"
        style="position:absolute; right:16px; top:16px; background:none; border:none; color:var(--muted); font-size:24px; cursor:pointer; padding:4px; line-height:1; z-index:10;">✕</button>
      <h2 id="modalTitle" style="margin-top:0; font-size:24px; margin-bottom:16px;"></h2>
      <img id="modalImg"
        style="width:100%; border-radius:0; border:1px solid var(--border); margin-bottom:20px; aspect-ratio:16/9; object-fit:cover;" />

      <!-- Timer Interface -->
      <div class="timer-container">
        <div id="timerDisplay" class="timer-display">00:00</div>
        <div class="timer-controls">
          <button class="timer-btn" onclick="addTime(30)">+30s</button>
          <button class="timer-btn" onclick="toggleTimer()" id="timerToggleBtn">Start</button>
          <button class="timer-btn" onclick="resetTimer()">Reset</button>
        </div>
      </div>

      <button id="fixResultBtn" onclick="confirmResult()"
        style="display:none; width:100%; margin-bottom:16px; padding:12px; font-size:16px; background:var(--done); color:#052e16; border:none; border-radius:0; font-weight:600; cursor:pointer;">
        Зафиксировать результат
      </button>

      <div id="sideAlert"
        style="display:none; background:rgba(56, 189, 248, 0.1); border:1px solid var(--accent); color:var(--accent); padding:10px; border-radius:0; margin-bottom:16px; font-weight:500; text-align:center;">
        ⚠️ Не забудьте выполнить на вторую сторону!
      </div>

      <div id="modalDesc" style="color:var(--text); line-height:1.6; font-size:15px;"></div>
    </div>
  </div>

  <script src="js/data.js"></script>
  <script src="js/app.js"></script>
</body>

</html>